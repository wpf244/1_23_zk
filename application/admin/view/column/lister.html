<!DOCTYPE html>
<html>
{include file="public:header"}
<link rel="stylesheet" href="__ADMIN__/js/themes/default/style.min.css">
<script src="__ADMIN__/js/jstree.min.js"></script>
<body class="no-skin">
<!--头部-->
{include file="public:nav"}

<div class="main-container ace-save-state" id="main-container">
  <!--菜单-->
  <script type="text/javascript">
  try{ace.settings.loadState('main-container')}catch(e){}
</script>

{include file="public:left"}

  <div class="main-content">
    <div class="main-content-inner">
      <div class="breadcrumbs ace-save-state" id="breadcrumbs">
        <ul class="breadcrumb">
          <li>
            <i class="ace-icon fa fa-home home-icon"></i>
            <a href="{:url('Index/index')}">首页</a>
          </li>
          <li class="active">栏目列表</li>
        </ul><!-- /.breadcrumb -->

      </div>

      <div class="page-content">
        {include file="public:set"}
        <div class="row">
          <div class="col-sm-10 col-sm-offset-1">
          <div class="col-sm-3">
              <!-- <div class="widget-box ui-sortable-handle" id="widget-box-1"> -->
              <div class="widget-box transparent" id="widget-box-1">
                  <div class="widget-header">
                  <h5 class="widget-title">栏目</h5>
                  <div class="widget-toolbar">
                  <div class="widget-menu">
                  <a href="#" data-action="settings" data-toggle="dropdown">
                  <i class="ace-icon fa fa-bars"></i>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-right dropdown-light-blue dropdown-caret dropdown-closer">
                  <li>
                  <a data-toggle="tab" href="#dropdown1">Option#1</a>
                  </li>
                  <li>
                  <a data-toggle="tab" href="#dropdown2">Option#2</a>
                  </li>
                  </ul>
                  </div>
                  <a href="#" data-action="fullscreen" class="orange2">
                  <i class="ace-icon fa fa-expand"></i>
                  </a>
                  <a href="#" data-action="reload">
                  <i class="ace-icon fa fa-refresh"></i>
                  </a>
                  <a href="#" data-action="collapse">
                  <i class="ace-icon fa fa-chevron-up"></i>
                  </a>
                  <a href="#" data-action="close">
                  <i class="ace-icon fa fa-times"></i>
                  </a>
                  </div>
                  </div>
                  <div class="widget-body">
                    <div class="widget-main">
                      <div id="column"></div>
                    </div>
                  </div>
                  </div>
          </div>
          <div class="col-sm-9">
              <form id="modal-form" class="form-horizontal" action="{:url('Column/usave')}" method="post" enctype="multipart/form-data">
                <div class="row">
                  <div class="col-sm-12">
                    <div class="widget-box transparent">
                      <div class="widget-header widget-header-flat">
                        <h4 class="widget-title"><i class="ace-icon fa fa-leaf green"></i>栏目信息</h4>
                        <div class="widget-toolbar no-border">
                            <button class="btn btn-xs btn-success bigger" id="add" type="button">
                              <i class="ace-icon fa fa-plus"></i>
                              添加
                            </button>
                            <button class="btn btn-xs bigger btn-danger dropdown-toggle" id="delete" data-toggle="dropdown" type="button">
                              <i class="ace-icon fa fa-remove icon-on-right"></i>
                            删除
                            </button>
                          
                            </div>
                      </div>
                      <div class="widget-body">
                        <div class="widget-main">
                          
                          <div class="form-group">
                            <label class="col-sm-2 control-label no-padding-right" for="">上级栏目</label>
                            <div class="col-sm-10">
                              <input class="form-control" type="text" id="parentname"  readonly required>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label no-padding-right" for="">栏目名称</label>
                            <div class="col-sm-10">
                              <input class="form-control" type="text" id="name" name="name" required>
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label no-padding-right" for="">对应栏目</label>
                            <div class="col-sm-10">
                              <input class="form-control" type="text" id="duiyingname" name="duiyingname">
                            </div>
                          </div>
                          <div class="form-group">
                            <label class="col-sm-2 control-label no-padding-right" for="">分类Url</label>
                            <div class="col-sm-10">
                              <input class="form-control" type="text" id="categoryurl" name="categoryurl">
                            </div>
                          </div>
                          <div class="form-group">
                              <label class="col-sm-2 control-label no-padding-right" for="">分类代码</label>
                              <div class="col-sm-10">
                                <input class="form-control" type="text" id="code"  name="code">
                              </div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-2 control-label no-padding-right" for="">分类图标</label>
                                <div class="col-sm-10">
                                  <input class="form-control" type="text" id="iconname"  name="iconname">
                                </div>
                              </div>
                          <div class="form-group">                                                                            
                           <label class="col-sm-2 control-label no-padding-right" for="">状态</label>
                            <div class="col-sm-2">
                              <label style="padding-top: 8px">
                                <input name="status" id="status" class="ace ace-switch ace-switch-6" type="checkbox" checked/>
                                <span class="lbl"></span>
                                <small>(是否启用)</small>
                              </label>
                            </div>
                            <label class="col-sm-2 control-label no-padding-right" for="">排序</label>
                                <div class="col-sm-6">
                                  <input class="input-small" name="orderid" id="orderid" type="number" value="0">
                                  <small>(数字越大越靠前)</small>
                                </div>
                          </div>
                     
                          <div class="form-group">
                            <label class="col-sm-2 control-label no-padding-right" for="">备注</label>
                            <div class="col-sm-10">
                              <textarea class="form-control" id="remark" name="remark" style="width:100%;"></textarea>
                            </div>
                          </div>
                          <div class="form-group">
                              <label class="col-sm-2 control-label no-padding-right" for="">分类图片</label>
                            <div class="col-sm-10 col-sm-offset-2">
                              <input multiple="" type="file" id="thumb" name="coverimage"/>
                              <img src="" id="image" class="img-responsive" />
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <input type="hidden" name="id" id="id" value="" />
                <input type="hidden" name="parentid" id="parentid" value="" />
                <div class="clearfix form-actions">
                  <div class="col-md-offset-3 col-md-9">
                    <button class="btn btn-info" type="submit">
                      <i class="ace-icon fa fa-floppy-o bigger-110"></i>
                      保存
                    </button>
                    <button class="btn" type="button">
                      <i class="ace-icon fa fa-undo bigger-110"></i>
                      重置
                    </button>
                  </div>
                </div>
              </form>
          </div>
        </div>
        </div><!-- /.row -->
      </div><!-- /.page-content -->
    </div>
  </div><!-- /.main-content -->

{include file="public:footer"}

<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
  <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
</a>
</div><!-- /.main-container -->
<script>
  jQuery(function($) {
    $('#thumb').ace_file_input({
        style: 'well',
        btn_choose: '封面图',
        btn_change: null,
        no_icon: 'ace-icon fa fa-picture-o',
        droppable: true,
        thumbnail: 'fit'//large | fit
        //,icon_remove:null//set null, to hide remove/reset button
        /**,before_change:function(files, dropped) {
						//Check an example below
						//or examples/file-upload.html
						return true;
					}*/
        /**,before_remove : function() {
						return true;
					}*/
        ,
        preview_error: function (filename, error_code) {
          //name of the file that failed
          //error_code values
          //1 = 'FILE_LOAD_FAILED',
          //2 = 'IMAGE_LOAD_FAILED',
          //3 = 'THUMBNAIL_FAILED'
          //alert(error_code);
        }

      }).on('change', function () {
        //console.log($(this).data('ace_input_files'));
        //console.log($(this).data('ace_input_method'));
      });


    $('.input-daterange').datepicker({
		  autoclose:true,
		  language:"zh-CN",
          format:"yyyy-mm-dd"
          });
   
    $('[data-rel=tooltip]').tooltip();

    $( "#hide-option" ).tooltip({
      hide: {
        effect: "explode",
        delay: 250
      }
    });
    // jstree
    var columData = {$data};
   
    $('#column').jstree({'core': {
      'data':columData
    
    }}).on("changed.jstree", function (e, data) {
      var text = (data.node.text);
       var id = data.selected[0];
       if(text == "周口政府"){
         layer.msg("根目录不允许更改");return false;
       }
       $.ajax({
         type:"post",
         url:"{:url('Column/modifys')}",
         data:{id:id},
         datatype:"json",
         success:function(re)
         {
             var re = JSON.parse(re);
             $("#parentname").val(re.parentname);
             $("#name").val(re.name);
             $("#duiyingname").val(re.duiyingname);
             $("#categoryurl").val(re.categoryurl);
             $("#status").prop("checked", data.status);
             $("#orderid").val(re.orderid);
             $("#remark").val(re.remark);
             $("#id").val(re.id);
             $("#code").val(re.code);
             $("#parentid").val(re.parentid);
             $("#iconname").val(re.iconname);
             $("#image").attr('src',data.coverimage);
         }

       })
    });
  })
</script>
<script>
 $("#add").click(function()
 {
   var id = $("#id").val();
   if(id == ''){
     layer.msg("请先选择上级栏目");return false;
   }else{
      location.href="__URL__/add/parentid/"+id;
   }
 })
</script>
<script>
  $("#delete").click(function()
  {
    var id = $("#id").val();
    if(id == ''){
      layer.msg("请先选择需要删除的栏目");return false;
    }else{
       dels(id);
    }
  })
 </script>
<script type="text/javascript">
		function dels(id){
			layer.confirm('你确定删除吗？此操作无法撤回，请谨慎操作', {icon: 3}, function(index){
		    layer.close(index);
		    $.ajax({
            type:"post",
            url:"{:url('Column/delete')}",
              data:{id:id},
              datatype:"text",
              success:function(re){
                if(re == 2 || re == 1){
                    layer.msg("系统繁忙请稍后再试");
                    setTimeout("location.reload()",2000);
                }
                
                if(re == 0){
                  layer.msg("删除成功")
                  setTimeout("location.reload()",2000);
                }
              }
          })
		  });
	    }
    </script>
    
    <script>
       
  $(".del-btnt").on(ace.click_event,function(){
	var valarr = [];
	var checkitem = $(".check:checked")
    var len = checkitem.length;
    if(len>0){
    	for(let i = 0; i < len;i++){
    		valarr.push(checkitem.eq(i).val())
    	}
      layer.confirm('你确定通过审核?',{icon: 3},function (index) {
        layer.close(index);
        window.location.href="adopt/id/"+valarr;
      });
    }else{
      layer.msg("请先选择数据");
    }
  });
    </script>

<script>
   
$(".del-btnj").on(ace.click_event,function(){
var valarr = [];
var checkitem = $(".check:checked")
var len = checkitem.length;
if(len>0){
  for(let i = 0; i < len;i++){
    valarr.push(checkitem.eq(i).val())
  }
  layer.confirm('你确定拒绝审核?',{icon: 3},function (index) {
    layer.close(index);
    window.location.href="refuse/id/"+valarr;
  });
}else{
  layer.msg("请先选择数据");
}
});
</script>
<script>
  $(function(){
    $('#modal-form').ajaxForm({
      beforeSubmit: checkForm, // 此方法主要是提交前执行的方法，根据需要设置
      success: complete, // 这是提交后的方法
      dataType: 'json'
    });
    
    function checkForm(){
      
      
      }
  
    function complete(data){
      if(data.status==1){
        layer.alert(data.msg, {icon: 5}, function(index){
         layer.close(index);
         window.location.href=data.url;
        });
        
      }else{
        layer.alert(data.msg, {icon: 6}, function(index){
         layer.close(index);
         window.location.href=data.url;
        });
        
      }
    }
   
  });
  
  </script>

</body>
</html>
